generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model BudgetPlan {
  id         String           @id @default(cuid())
  name       String
  isDefault  Boolean          @default(false)
  isCustom   Boolean          @default(false)
  categories BudgetCategory[]
  userConfig UserConfig[]
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
}

model BudgetCategory {
  id                    String                 @id @default(cuid())
  name                  String
  percentage            Float
  isSavings             Boolean                @default(false)
  plan                  BudgetPlan             @relation(fields: [planId], references: [id], onDelete: Cascade)
  planId                String
  transactions          Transaction[]
  savingsGoals          SavingsGoal[]
  recurringTransactions RecurringTransaction[]
}

model UserConfig {
  id           String     @id @default(cuid())
  activePlan   BudgetPlan @relation(fields: [activePlanId], references: [id])
  activePlanId String
  currency     String     @default("THB")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Transaction {
  id          String          @id @default(cuid())
  amount      Float
  type        TransactionType
  note        String?
  date        DateTime        @default(now())
  category    BudgetCategory? @relation(fields: [categoryId], references: [id])
  categoryId  String?
  recurringId String?
  isRecurring Boolean         @default(false)
  tags        TransactionTag[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model Tag {
  id           String           @id @default(cuid())
  name         String           @unique
  transactions TransactionTag[]
  createdAt    DateTime         @default(now())
}

model TransactionTag {
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  transactionId String
  tag           Tag         @relation(fields: [tagId], references: [id], onDelete: Cascade)
  tagId         String

  @@id([transactionId, tagId])
}

model SavingsGoal {
  id           String          @id @default(cuid())
  name         String
  targetAmount Float
  deadline     DateTime?
  categoryId   String?
  category     BudgetCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model RecurringTransaction {
  id         String          @id @default(cuid())
  amount     Float
  type       TransactionType
  note       String?
  dayOfMonth Int
  isActive   Boolean         @default(true)
  categoryId String?
  category   BudgetCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
}

enum TransactionType {
  INCOME
  EXPENSE
  SAVINGS
}
